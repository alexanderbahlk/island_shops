#!/bin/bash
set -e

echo "Starting Rails application..."

# Remove any existing server.pid
rm -f tmp/pids/server.pid

# Try to create database (ignore if exists)
echo "Setting up database..."
bundle exec rails db:create 2>/dev/null || echo "Database already exists"

# Run migrations
echo "Running migrations..."
bundle exec rails db:migrate

echo "Starting Rails server on 0.0.0.0:3000..."
exec bundle exec rails server -b 0.0.0.0 -p 3000