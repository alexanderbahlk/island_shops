#!/bin/bash
set -e

# Remove a potentially pre-existing server.pid for Rails.
rm -f /rails/tmp/pids/server.pid

# Precompile assets if they don't exist
if [ ! -d "public/assets" ]; then
  echo "Precompiling assets..."
  bundle exec rails assets:precompile
fi

# Run database migrations (but don't fail if it errors)
echo "Running database migrations..."
bundle exec rails db:create 2>/dev/null || true
bundle exec rails db:migrate 2>/dev/null || true

echo "Starting Rails server on 0.0.0.0:3000..."
exec "$@"