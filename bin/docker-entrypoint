#!/bin/bash
set -e

echo "Starting Redis..."
redis-server --daemonize yes
sleep 2  # Give Redis a moment to start
echo "Redis started."

echo "Starting Rails application..."

# Remove any existing server.pid
rm -f tmp/pids/server.pid

# Try to create database (ignore if exists)
#echo "Setting up database..."
#bundle exec rails db:create 2>/dev/null || echo "Database already exists"

echo "Skipping database setup - using managed database..."

# Run migrations
#echo "Running migrations..."
#bundle exec rails db:migrate

echo "Starting Rails server on 0.0.0.0:3000..."
exec bundle exec rails server -b 0.0.0.0 -p 3000